<html xmlns="http://www.w3.org/1999/xhtml">
<head id="Head1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="pragma" content="no-cache">
    <!-- HTTP 1.0 -->
    <meta http-equiv="cache-control" content="no-cache">
    <!-- Prevent caching at the proxy server -->
    <meta http-equiv="expires" content="0">
    <title>危急值结果查询</title>
    <link href="../ui/easyui/demo/demo.css" rel="stylesheet" type="text/css" />
    <link href="../ui/easyui/themes/icon.css" rel="stylesheet" type="text/css" />
    <link href="../ui/easyui/themes/default/easyui.css" rel="stylesheet" type="text/css" />
    <script src="../ui/easyui/jquery.min.js" type="text/javascript"></script>
    <script src="../ui/easyui/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="../ui/easyui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
    <script src="../ui/util/util.js?v20200810-1" type="text/javascript"></script>
    <script src="../ui/print/Print.js" type="text/javascript"></script>
    <script src="../ui/entry_taihe/barcode.js" type="text/javascript"></script>
    <script language="javascript">
        $(function () {
            var inputflag = 0;
            var IsDelivery = 0;
            var IsReceive = 0;
            var para = Shell.getRequestParams();


            var datetimenow = new Date();
            var datetimestr = datetimenow.getFullYear() + "-" + (datetimenow.getMonth() + 1) + "-" + datetimenow.getDate();
            $('#OperateStartDateTime').datebox('setValue', datetimestr);
            $('#OperateEndDateTime').datebox('setValue', datetimestr);

            $('#btnsearch').bind('click', function () {
                var wherestr = " 1=1 ";
                if ($('#txtClientNo').combobox('getValue')) {
                    wherestr += " and ClientNo='" + $('#txtClientNo').combobox('getValue') + "'";
                }

                if ($('#SelectDoctor').combobox('getValue')) {
                    wherestr += " and DOCTORNAME='" + $('#SelectDoctor').combobox('getValue') + "'";
                }

                if ($('#CName').textbox('getValue')) {
                    wherestr += " and CName='" + $('#CName').textbox('getValue') + "'";
                }

                if ($('#PatNo').textbox('getValue')) {
                    wherestr += " and PatNo='" + $('#PatNo').textbox('getValue') + "'";
                }

                if ($('#OperateStartDateTime').datebox('getValue')) {
                    wherestr += " and TESTDATE>='" + $('#OperateStartDateTime').datebox('getValue') + "'";
                }

                if ($('#OperateEndDateTime').datebox('getValue')) {
                    wherestr += " and TESTDATE<='" + $('#OperateEndDateTime').datebox('getValue') + " 23:59:59'";
                }

                $('#NRequestFormList').datagrid({
                    url: '../ServiceWCF/ReportFromService.svc/SearchReportFormFull_ReportItem_WeiJiZhi?guid=' + generateMixed(10),
                    queryParams: {
                        wherestr: wherestr
                    }
                });
            });
            $('#SelectDoctor').combobox({
                url: '../ServiceWCF/DictionaryService.svc/GetCenterDoctorAllList',
                method: 'GET',
                valueField: 'DoctorNo',
                textField: 'CName'
            });

            $('#NRequestFormList').datagrid({
                //url: '../ServiceWCF/NRequestFromService.svc/GetNRequestFromListByRBAC',
                method: 'GET',
                rownumbers: true,
                singleSelect: false,
                pagination: true,
                fitColumns: true,
                striped: true,
                columns: [[
                    { field: 'CNAME', title: '姓名', width: 50 },
                    { field: 'GENDERNAME', title: '性别', width: 30, align: 'center' },
                    { field: 'AGE', title: '年龄(岁)', width: 50 },
                    { field: 'SAMPLETYPENAME', title: '样本类型', width: 50 },
                    { field: 'TESTITEMNAME', title: '项目', width: 150, align: 'center' },
                    { field: 'REPORTVALUEALL', title: '结果值', width: 90, align: 'center' },
                    { field: 'UNIT', title: '单位', width: 90, align: 'center' },
                    { field: 'REFRANGE', title: '参考范围', width: 90, align: 'center' },
                    { field: 'TESTDATE', title: '检测时间', width: 90, align: 'center' },

                    //{
                    //    field: 'WebLisFlag', title: '样本状态', width: 90, align: 'center',
                    //    formatter: function (value, row, index) {
                    //        if (value == '') {
                    //            return row.WebLisFlag = '待外送';
                    //        }
                    //        if (value == '0') {
                    //            return row.WebLisFlag = '待外送';
                    //        }
                    //        if (value == '1') {
                    //            return row.WebLisFlag = '已打包';
                    //        }
                    //        if (value == '2') {
                    //            return row.WebLisFlag = '已外送';
                    //        }

                    //        if (value == '5') {
                    //            return row.WebLisFlag = '已签收';
                    //        }
                    //        if (value == '6') {
                    //            return row.WebLisFlag = '已拒收';
                    //        }

                    //    },
                    //    styler: function (value, row, index) {
                    //        if (value == '') {
                    //            return 'background-color:ffffff;';
                    //        }
                    //        if (value == '0') {
                    //            return 'background-color:ffffff;';
                    //        }
                    //        if (value == '1') {
                    //            return 'background-color:FFaaCC;';
                    //        }
                    //        if (value == '2') {
                    //            return 'background-color:FFaa00;';
                    //        }
                    //        if (value == '5') {
                    //            return 'background-color:FFF2CC;';
                    //        }
                    //        if (value == '6') {
                    //            return 'background-color:red;';
                    //        }
                    //        return "";
                    //    }
                    //},
                    { field: 'ItemRESULTSTATUS', title: '结果状态', width: 30 },
                    { field: 'CLIENTNAME', title: '送检单位', width: 80, align: 'center' }
                ]],
                //                queryParams: {
                //                    jsonentity: "{ClientNo:1,OperDateStart:'2014-11-01',OperDateEnd:'2014-11-27'}"
                //                },
                onDblClickCell: function (index, field, value) {
                    alert(index);
                },
                loadFilter: function (data) {
                    var result = eval("(" + data.ResultDataValue + ")");
                    var totalcount = 0;
                    if (result.total) {
                        totalcount = result.total;
                    }
                    return { total: totalcount, rows: result.rows || [] };
                }
            });
            $('#txtClientNo').combobox({
                url: '../ServiceWCF/DictionaryService.svc/GetClientListByRBAC?guid=' + generateMixed(10) + '&page=1&rows=1000&fields=CLIENTELE.CNAME,CLIENTELE.ClIENTNO&where=&sort=',
                method: 'GET',
                valueField: 'ClIENTNO',
                textField: 'CNAME',
                loadFilter: function (data) {
                    if (data.length > 0) {
                        data[0].selected = true;
                    }
                    return data;
                },
                onLoadSuccess: function () {
                    $('#btnsearch').click();
                }
                //mode:'remote'//,
                //                onSelect: function (Key) {
                //                    var url = '../ServiceWCF/DictionaryService.svc/GetClientListByRBACAndInputKey?page=1&limit=10&fields=CLIENTELE.CNAME,CLIENTELE.ClIENTNO&where=&sort=&inputkey=' + Key;
                //                    $('#txtClientNo').combobox('reload', url);
                //                }
            });
        });
        function viewrow(NRequestFormNo) {
            var SN = Shell.util.Path.getRequestParams()["SN"];
            parent.OpenWindowFuc('修改申请单', Math.floor(window.screen.width * 0.9), Math.floor(window.screen.height * 0.7), '../ui/entry_taihe/apply.html?Flag=1&NRequestFormNo=' + NRequestFormNo + '&BarCodeInputFlag=1&ReadOnly=1', SN);
            //var url = "ApplyInput_Weblis_dajia.aspx?Flag=1&NRequestFormNo=" + NRequestFormNo + "&BarCodeInputFlag=1";
            //window.open(url, "修改申请单", "width=" + Math.floor(window.screen.width * 0.9) + ",height=" + Math.floor(window.screen.height * 0.8) + ",toolbar=no,menubar=no,scrollbars=yes,resizable=yes,location=no,status=no,top=" + Math.floor(window.screen.height * 0.1) + ",left=" + Math.floor(window.screen.width * 0.05));

        }
        var chars = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];

        function generateMixed(n) {
            var res = "";
            for (var i = 0; i < n; i++) {
                var id = Math.ceil(Math.random() * 35);
                res += chars[id];
            }
            return res;
        }

        function ContentReLoad() {
            //$('#btnsearch').click();
            $('#NRequestFormList').datagrid('reload');
        }
    </script>
</head>
<body class="easyui-layout" data-options="fit:true,width:'auto'">
    <form id="form1">
        <div id="mainpanel" class="easyui-layout" data-options="fit:true,border:false" style="width: 200px; height: 100%;">
            <div data-options="region:'north',iconCls:'icon-search'" title="危急值结果查询" style="height: 100px">
                <div style="float: left">
                    <div style="padding: 5px;">
                        送检单位：<input id="txtClientNo" class="easyui-combobox" style="width: 218px" />
                        医&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;生：<input id="SelectDoctor" class="easyui-combobox"
                                                                      style="width: 100px" />
                        姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名：<input id="CName" class="easyui-textbox" style="width: 100px" />
                        病&nbsp;&nbsp;历&nbsp;&nbsp;号：<input id="PatNo" class="easyui-textbox" style="width: 100px" />
                    </div>
                    <div style="padding: 5px;">
                        检测时间：<input id="OperateStartDateTime" class="easyui-datebox" editable='false' style="width: 100px" />
                        --
                        <input id="OperateEndDateTime" class="easyui-datebox" editable='false' style="width: 100px" />
                    </div>
                </div>
                <div style="float: right; vertical-align: middle; border: 1px; border-color: Black; height: 100%">
                    <a id="btnsearch" href="#" style="margin-top: 10px; margin-bottom: 10px;" class="easyui-linkbutton" data-options="iconCls:'icon-search',size:'large'">查询</a>

                </div>
            </div>
            <div data-options="region:'center',title:'结果列表',iconCls:'icon-app-grid-16',tools:'#ToolsPanel'">
                <div id="NRequestFormList" class="easyui-datagrid" data-options="border:false,singleSelect:true,fit:true,fitColumns:true">
                </div>
            </div>
        </div>
    </form>
    <!-- 网页打印 -->
    <object id="LODOP_OB" classid="clsid:2105C259-1E0C-4534-8141-A753534CB4CA" width="0" height="0">
        <embed id="LODOP_EM" type="application/x-print-lodop" width="0" height="0" pluginspage="resources/install_lodop32.exe"></embed>
    </object>
</body>
</html>
