<?xml version="1.0" encoding="utf-8"?>
<configuration>

	<configSections>
		<sectionGroup name="spring">
			<section name="context" type="Spring.Context.Support.ContextHandler, Spring.Core"/>
			<section name="parsers" type="Spring.Context.Support.NamespaceParsersSectionHandler, Spring.Core"/>
			<section name="objects" type="Spring.Context.Support.DefaultSectionHandler, Spring.Core"/>
		</sectionGroup>
		<section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler, log4net" />
		<section name="databaseSettings" type="System.Configuration.NameValueSectionHandler" />
	</configSections>
	<!--spring配置-->
	<spring xmlns="http://www.springframework.net">
		<parsers>
			<parser type="Spring.Data.Config.DatabaseNamespaceParser, Spring.Data" />
			<parser type="Spring.Transaction.Config.TxNamespaceParser, Spring.Data" />
		</parsers>
		<context>
			<resource uri="config://spring/objects" />
			<!--数据库访问层配置-->
			<resource uri="assembly://ZhiFang.Digitlab.ObjectFactory.ReagentSys/ZhiFang.Digitlab.ObjectFactory.ReagentSys.Config/DaoBase.xml" />
			<resource uri="assembly://ZhiFang.Digitlab.ObjectFactory.ReagentSys/ZhiFang.Digitlab.ObjectFactory.ReagentSys.Config/Dao.xml" />
			<!--业务处理层配置-->
			<resource uri="assembly://ZhiFang.Digitlab.ObjectFactory.ReagentSys/ZhiFang.Digitlab.ObjectFactory.ReagentSys.Config/ServiceBase.xml" />
			<resource uri="assembly://ZhiFang.Digitlab.ObjectFactory.ReagentSys/ZhiFang.Digitlab.ObjectFactory.ReagentSys.Config/Service.xml" />
			<!--契约实现-->
			<resource uri="assembly://ZhiFang.Digitlab.ObjectFactory.ReagentSys/ZhiFang.Digitlab.ObjectFactory.ReagentSys.Config/Facade.xml" />
		</context>
		<objects xmlns="http://www.springframework.net" xmlns:aop="http://www.springframework.net/aop">
			<!--拦截控制层所有业务操作-->
			<!--
			<object id="serviceOperation" type="Spring.Aop.Support.SdkRegularExpressionMethodPointcut, Spring.Aop">
				<property name="Patterns">
					<list>
						-->
			<!--<value>ZhiFang.Digitlab.ReagentSys.*</value>-->
			<!--
						<value>ZhiFang.Digitlab.ServiceCommon.*</value>
					</list>
				</property>
			</object>-->
			<!--数据库升级-->
			<object id="UpdateDataBase" type="Spring.Aop.Support.SdkRegularExpressionMethodPointcut, Spring.Aop">
				<property name="Patterns">
					<list>
						<value>ZhiFang.Digitlab.ReagentSys.RBACService.*</value>
					</list>
				</property>
			</object>

			<!--拦截服务层所有业务操作-->
			<object id="LoginValidationOperation" type="Spring.Aop.Support.SdkRegularExpressionMethodPointcut, Spring.Aop">
				<property name="Patterns">
					<list>
						<value>ZhiFang.Digitlab.ReagentSys.ReagentService.*</value>
						<value>ZhiFang.Digitlab.ReagentSys.ReagentSysService.*</value>
					</list>
				</property>
			</object>

			<!--切面-->
			<!--
			<object id="LogAdvice" type="ZhiFang.Digitlab.Interceptor.ReagentSys.InterceptorLog, ZhiFang.Digitlab.Interceptor.ReagentSys" singleton="false"/>
			-->
			<!--切面-->
			<!--
			<object id="BeforeAdvice" type="ZhiFang.Digitlab.Interceptor.ReagentSys.InterceptorAuthorityFilter, ZhiFang.Digitlab.Interceptor.ReagentSys" singleton="false"/>
			-->
			<!--切面-->
			<!--
			<object id="AfterAdvice" type="ZhiFang.Digitlab.Interceptor.ReagentSys.AfterReturningAdvice, ZhiFang.Digitlab.Interceptor.ReagentSys" singleton="false"/>
			-->
			<!--切面-->
			<!--
			<object id="ExceptAdvice" type="ZhiFang.Digitlab.Interceptor.ReagentSys.ExceptAdvice, ZhiFang.Digitlab.Interceptor.ReagentSys" singleton="false"/>-->

			<object id="UpdateDataBaseAdvice" type="ZhiFang.Digitlab.Interceptor.ReagentSys.UpdateDataBaseAdvice, ZhiFang.Digitlab.Interceptor.ReagentSys" singleton="false" />

			<!--登录验证切面-->
			<object id="LoginValidationAdvice" type="ZhiFang.Digitlab.Interceptor.ReagentSys.LoginValidationAdvice, ZhiFang.Digitlab.Interceptor.ReagentSys" singleton="false"/>

			<!--关联切面-->
			<aop:config>
				<!--<aop:advisor pointcut-ref="serviceOperation" advice-ref="LogAdvice"/>
				<aop:advisor pointcut-ref="serviceOperation" advice-ref="BeforeAdvice"/>
				<aop:advisor pointcut-ref="serviceOperation" advice-ref="AfterAdvice"/>
				<aop:advisor pointcut-ref="serviceOperation" advice-ref="ExceptAdvice"/>-->
				<aop:advisor pointcut-ref="UpdateDataBase" advice-ref="UpdateDataBaseAdvice" />
				<aop:advisor pointcut-ref="LoginValidationOperation" advice-ref="LoginValidationAdvice"/>
			</aop:config>
		</objects>
	</spring>
	<!--数据库连接字符串-->

	<databaseSettings>
		<!--.\SQLEXPRESS-->
		<add key="db.provider" value="SqlServer-2.0" />
		<add key="db.connectionString" value="Server=.\MSSQLSERVER2012;database=ZhiFang.Digitlab.ReagentSys;uid=sa;pwd=longfuchu;" />
		<add key="db.driver_class" value="NHibernate.Driver.SqlClientDriver" />
		<add key="db.dialect" value="NHibernate.Dialect.MsSql2005Dialect" />
		<add key="hbm2ddl.auto" value="update" />
	</databaseSettings>

	<appSettings>
		<!--上传注册证原件的保存路径(物理路径)-->
		<add key="UploadRegisterFile" value="D:\ZhiFang.Digitlab.ReagentSys\UploadFiles" />
		<add key="Spring.Data.NHibernate.Support.SessionScope.SessionFactoryObjectName" value="NHibernateSessionFactory"/>
		<add key="EntityNamespace" value="ZhiFang.Digitlab.Entity.ReagentSys"/>
		<add key="ReportTemplateDir" value="ReportTemplate"/>
		<add key="ReportTemplateFileextension" value=".frx"/>
		<!--微信参数-->
		<add key="appid" value="wx82fee0402905390c"/>
		<add key="appsecret" value="28eb6ea1135bc8999d54644ce894aaf6"/>
		<add key="GetTokenUrl" value="https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential"/>
		<add key="GetOpenIdListUrl" value="https://api.weixin.qq.com/cgi-bin/user/get"/>
		<add key="GetOpenIdUrl" value="https://api.weixin.qq.com/cgi-bin/user/info"/>
		<!--<add key="GetUserAuthorizeCode" value="https://open.weixin.qq.com/connect/oauth2/authorize?appid=APPID&redirect_uri=REDIRECT_URI&response_type=code&scope=SCOPE&state=STATE#wechat_redirect"/>-->
		<add key="GetUserAuthorizeTokenUrl" value="https://api.weixin.qq.com/sns/oauth2/access_token"/>
		<add key="GetUserAuthorizeTokenRefreshUrl" value="https://api.weixin.qq.com/sns/oauth2/refresh_token"/>
		<add key="GetJSAPITokenUrl" value="https://api.weixin.qq.com/cgi-bin/ticket/getticket"/>
		<add key="PushMsgUrl" value="https://api.weixin.qq.com/cgi-bin/message/custom/send"/>
		<add key="GetMediaUrl" value="http://file.api.weixin.qq.com/cgi-bin/media/get"/>
		<add key="GetPermanentMediaListUrl" value="https://api.weixin.qq.com/cgi-bin/material/batchget_material"/>
		<add key="GetPermanentMediaFileUrl" value="https://api.weixin.qq.com/cgi-bin/material/get_material"/>
		<add key="Domain" value="demo.zhifang.com.cn"/>
		<!--模版消息-->
		<add key="SetBusinessUrl" value="https://api.weixin.qq.com/cgi-bin/template/api_set_industry"/>
		<add key="GetBusinessTemplateIdUrl" value="https://api.weixin.qq.com/cgi-bin/template/api_add_template"/>
		<add key="PushMessageTemplateContextUrl" value="https://api.weixin.qq.com/cgi-bin/message/template/send"/>
		<!--消息推送开关0：不推送，1推送。默认不推送-->
		<add key="PushMessageFlag" value="0"/>
		<!--模版消息-->
		<add key="SJBhttpReg" value="101100-SJB-ZFKJ-867438"/>
		<add key="SJBhttpPWD" value="VHODXCGZ"/>
		<add key="SJBhttpVaildModule" value="(检验之星平台验证码,十分钟内有效)【智方科技】"/>
		<add key="VaildCodeTimeOut"  value="300"/>
		<!--欢迎词-->
		<add key="WelcomeStr" value="'XXX'您好！检验之星服务号正在建设中，感谢您的关注！"/>
		<add key="WelcomeStrInput" value="请输入“手机号:xxx”或“身份证号:xxx”进行绑定或直接输入“条码号:xxx”进行查询！"/>
		<!--是否强制注册手机号（1开启0关闭）-->
		<add key="RegeditMobileFlag" value="1"/>
		<!--微信版本-->
		<add key="WeiXinVersion" value="0000.0000.0000.0000"/>
		<!--微信参数-->
		<!--订单自动审核时间间隔，单位秒-->
		<add key="AutoCheckOrderDocTime" value="60"/>
		<!--巴瑞订单新旧接口类型-->
		<add key="BaronInterfaceType" value="1"/>
    <!--关闭自动刷新-->
    <add key="vs:EnableBrowseLink" value="false"/>
	</appSettings>

	<system.web>
		<httpRuntime requestValidationMode="2.0" maxQueryStringLength="102400" maxRequestLength="409600"/>
		<pages validateRequest="false" />
		<compilation debug="true" targetFramework="4.0" />
		<customErrors mode="Off"></customErrors>
	</system.web>

	<system.serviceModel>
		<client>
			<endpoint address="http://dh.baron232.com/webservice1/UserApi.asmx"
			 binding="basicHttpBinding" bindingConfiguration="UserApiSoap"
			 contract="ServiceReference_Baron.UserApiSoap" name="UserApiSoap" />
			<endpoint address="http://localhost/ZhiFang.Digitlab.ReagentSys/ZFClientService.asmx"
			 binding="basicHttpBinding" bindingConfiguration="ZFClientServiceSoap"
			 contract="ServiceReference_ZFClient.ZFClientServiceSoap" name="ZFClientServiceSoap" />
			<endpoint address="http://bps.rf-bj.com/webservice1/userapi.asmx"
			 binding="basicHttpBinding" bindingConfiguration="UserApiSoap"
			 contract="ServiceReference_Baron_RF.UserApiSoap" name="UserApiSoap" />
		</client>
		<services>
			<service name="ZhiFang.Digitlab.ReagentSys.RBACService">
				<endpoint address="" behaviorConfiguration="ZhiFang.Digitlab.ReagentSys.RBACServiceAspNetAjaxBehavior"
				 binding="webHttpBinding" contract="ZhiFang.Digitlab.ReagentSys.ServerContract.IRBACService" />
			</service>
			<service name="ZhiFang.Digitlab.ReagentSys.ConstructionService">
				<endpoint address="" behaviorConfiguration="ZhiFang.Digitlab.ReagentSys.ConstructionServiceAspNetAjaxBehavior"
				 binding="webHttpBinding" contract="ZhiFang.Digitlab.ReagentSys.ServerContract.IConstructionService" />
			</service>
			<service name="ZhiFang.Digitlab.ReagentSys.SingleTableService">
				<endpoint address="" behaviorConfiguration="ZhiFang.Digitlab.ReagentSys.SingleTableServiceAspNetAjaxBehavior"
				 binding="webHttpBinding" contract="ZhiFang.Digitlab.ReagentSys.ServerContract.ISingleTableService" />
			</service>
			<service name="ZhiFang.Digitlab.ReagentSys.ReagentService">
				<endpoint address="" behaviorConfiguration="ZhiFang.Digitlab.ReagentSys.ReagentServiceAspNetAjaxBehavior"
				 binding="webHttpBinding" name="ReagentService" contract="ZhiFang.Digitlab.ReagentSys.ServerContract.IReagentService" />
			</service>
			<service name="ZhiFang.Digitlab.ReagentSys.ReagentSysService">
				<endpoint address="" behaviorConfiguration="ZhiFang.Digitlab.ReagentSys.ReagentSysServiceAspNetAjaxBehavior"
				 binding="webHttpBinding" contract="ZhiFang.Digitlab.ReagentSys.ServerContract.IReagentSysService" />
			</service>
			<service name="ZhiFang.Digitlab.ReagentSys.PublicService">
				<endpoint address="" behaviorConfiguration="ZhiFang.Digitlab.ReagentSys.PublicServiceAspNetAjaxBehavior"
				 binding="webHttpBinding" contract="ZhiFang.Digitlab.ReagentSys.ServerContract.IPublicService" />
			</service>
			<service name="ZhiFang.Digitlab.ReagentSys.WeiXinAppService">
				<endpoint address="" behaviorConfiguration="ZhiFang.Digitlab.ReagentSys.WeiXinAppServiceAspNetAjaxBehavior"
				 binding="webHttpBinding" contract="ZhiFang.Digitlab.ReagentSys.ServerContract.IWeiXinAppService" />
			</service>
			<service name="ZhiFang.Digitlab.ReagentSys.ZFReaRestfulService">
				<endpoint address="" behaviorConfiguration="ZhiFang.Digitlab.ReagentSys.ZFReaRestfulServiceAspNetAjaxBehavior"
				 binding="webHttpBinding" contract="ZhiFang.Digitlab.ReagentSys.ServerContract.IZFReaRestfulService" />
			</service>
			<service name="ZhiFang.Digitlab.ReagentSys.ReaManageService">
				<endpoint address="" behaviorConfiguration="ZhiFang.Digitlab.ReagentSys.ReaManageServiceAspNetAjaxBehavior"
				 binding="webHttpBinding" contract="ZhiFang.Digitlab.ReagentSys.ServerContract.IReaManageService" />
			</service>
			<service name="ZhiFang.Digitlab.ReagentSys.ReaSysManageService">
				<endpoint address="" behaviorConfiguration="ZhiFang.Digitlab.ReagentSys.ReaSysManageServiceAspNetAjaxBehavior"
				 binding="webHttpBinding" contract="ZhiFang.Digitlab.ReagentSys.ServerContract.IReaSysManageService" />
			</service>
			<service name="ZhiFang.Digitlab.ReagentSys.ReaADOService">
				<endpoint address="" behaviorConfiguration="ZhiFang.Digitlab.ReagentSys.ReaADOServiceAspNetAjaxBehavior"
				 binding="webHttpBinding" contract="ZhiFang.Digitlab.ReagentSys.ServerContract.IReaADOService" />
			</service>
		</services>
		<behaviors>
			<endpointBehaviors>
				<behavior name="ZhiFang.Digitlab.ReagentSys.RBACServiceAspNetAjaxBehavior">
					<webHttp helpEnabled="true" />
				</behavior>
				<behavior name="ZhiFang.Digitlab.ReagentSys.ConstructionServiceAspNetAjaxBehavior">
					<webHttp helpEnabled="true" />
				</behavior>
				<behavior name="ZhiFang.Digitlab.ReagentSys.SingleTableServiceAspNetAjaxBehavior">
					<webHttp helpEnabled="true" />
				</behavior>
				<behavior name="ZhiFang.Digitlab.ReagentSys.ReagentServiceAspNetAjaxBehavior">
					<webHttp helpEnabled="true" />
				</behavior>
				<behavior name="ZhiFang.Digitlab.ReagentSys.ReagentSysServiceAspNetAjaxBehavior">
					<webHttp helpEnabled="true" />
				</behavior>
				<behavior name="ZhiFang.Digitlab.ReagentSys.PublicServiceAspNetAjaxBehavior">
					<webHttp helpEnabled="true" />
				</behavior>
				<behavior name="ZhiFang.Digitlab.ReagentSys.ServerContract.ReagentSysServiceAspNetAjaxBehavior">
					<webHttp helpEnabled="true" />
				</behavior>
				<behavior name="ZhiFang.Digitlab.ReagentSys.WeiXinAppServiceAspNetAjaxBehavior">
					<webHttp helpEnabled="true" />
				</behavior>
				<behavior name="ZhiFang.Digitlab.ReagentSys.ZFReaRestfulServiceAspNetAjaxBehavior">
					<webHttp helpEnabled="true" />
				</behavior>
				<behavior name="ZhiFang.Digitlab.ReagentSys.ReaManageServiceAspNetAjaxBehavior">
					<webHttp helpEnabled="true" />
				</behavior>
				<behavior name="ZhiFang.Digitlab.ReagentSys.ReaSysManageServiceAspNetAjaxBehavior">
					<webHttp helpEnabled="true" />
				</behavior>
				<behavior name="ZhiFang.Digitlab.ReagentSys.ReaADOServiceAspNetAjaxBehavior">
					<webHttp helpEnabled="true" />
				</behavior>
			</endpointBehaviors>
			<serviceBehaviors>
				<behavior name="DefaultBehavior">
					<serviceMetadata httpGetEnabled="true" />
					<serviceDebug includeExceptionDetailInFaults="true" />
				</behavior>
				<behavior name="">
					<serviceMetadata httpGetEnabled="true" />
					<serviceDebug includeExceptionDetailInFaults="false" />
				</behavior>
			</serviceBehaviors>
		</behaviors>
		<bindings>
			<basicHttpBinding>
				<binding closeTimeout="00:10:00" openTimeout="00:10:00" receiveTimeout="00:10:00"
				 sendTimeout="00:10:00" allowCookies="false" bypassProxyOnLocal="false"
				 hostNameComparisonMode="StrongWildcard" maxBufferPoolSize="2147483647"
				 maxBufferSize="2147483647" maxReceivedMessageSize="2147483647"
				 textEncoding="utf-8" transferMode="Buffered" useDefaultWebProxy="true"
				 messageEncoding="Text">
					<readerQuotas maxDepth="2147483647" maxStringContentLength="2147483647"
					 maxArrayLength="2147483647" maxBytesPerRead="2147483647" maxNameTableCharCount="2147483647" />
				</binding>
				<binding name="UserApiSoap">
					<readerQuotas maxDepth="2147483647" maxStringContentLength="2147483647"
					 maxArrayLength="2147483647" maxBytesPerRead="2147483647" maxNameTableCharCount="2147483647" />
				</binding>
				<binding name="ZFClientServiceSoap">
					<readerQuotas maxDepth="2147483647" maxStringContentLength="2147483647"
					 maxArrayLength="2147483647" maxBytesPerRead="2147483647" maxNameTableCharCount="2147483647" />
				</binding>
			</basicHttpBinding>
			<webHttpBinding>
				<binding closeTimeout="00:10:00" openTimeout="00:01:00" receiveTimeout="00:10:00"
				 sendTimeout="00:01:00" allowCookies="true" maxBufferSize="2147483647"
				 maxBufferPoolSize="9223372036854775807" maxReceivedMessageSize="2147483647" />
				<binding name="ReagentService">
					<readerQuotas maxDepth="2147483647" maxStringContentLength="2147483647"
					 maxArrayLength="2147483647" maxBytesPerRead="2147483647" maxNameTableCharCount="2147483647" />
				</binding>
			</webHttpBinding>
		</bindings>
		<serviceHostingEnvironment aspNetCompatibilityEnabled="true"
	 multipleSiteBindingsEnabled="true" />
	</system.serviceModel>

	<system.webServer>
		<modules runAllManagedModulesForAllRequests="true">
			<!-- Register the managed module -->
			<add name="WcfReadEntityBodyModeWorkaroundModule" type="ZhiFang.Digitlab.ReagentSys.HttpModule.WcfReadEntityBodyModeWorkaroundModule, ZhiFang.Digitlab.ReagentSys" />
		</modules>
		<staticContent>
			<mimeMap fileExtension=".svc" mimeType="application/json; charset=UTF-8" />
		</staticContent>
		<security>
			<requestFiltering>
				<requestLimits maxQueryString="102400"></requestLimits>
			</requestFiltering>
		</security>
		<defaultDocument>
			<files>
				<clear />
				<add value="index.html" />
			</files>
		</defaultDocument>
	</system.webServer>

</configuration>
