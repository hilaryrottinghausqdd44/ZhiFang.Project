Ext.ns('Ext.zhifangux'),Ext.define('Ext.zhifangux.AddAccount',{extend:'Ext.form.Panel',alias:'widget.addaccount',title:'账号申请',width:425,height:295,header:!0,objectName:'RBACUser',AccountValue:'',dateNew:new Date,isSuccessMsg:!0,getAppInfoServerUrl:getRootPath()+'/'+'ConstructionService.svc/CS_UDTO_SearchBTDAppComponentsById',addDataServerUrl:'RBACService.svc/RBAC_UDTO_AddRBACUser',editDataServerUrl:'RBACService.svc/RBAC_UDTO_UpdateRBACUserByField',classCode:'BTDAppComponents_ClassCode',autoScroll:!0,type:'add',bodyCls:'',isok:!1,layout:'absolute',CheckUserNameUrl:getRootPath()+'/'+'RBACService.svc/RBAC_RJ_ValidateUserAccountIsExist',CreateUserAccountUrl:getRootPath()+'/'+'RBACService.svc/RBAC_RJ_AutoCreateUserAccount',RandomPwdUrl:getRootPath()+'/'+'RBACService.svc/RBAC_RJ_GetRandomNumber',setWinformInfo:function(e,t){var n=this,r=t.boundField,i=e.get('Id'),s=e.get('text'),o=n.getComponent(r);o.treeNodeID=e.get('Id');if(o.xtype=='combobox'){var u=[[i,s]];o.store=new Ext.data.SimpleStore({fields:['value','text'],data:u,autoLoad:!0}),o.setValue(i)}else o.treeNodeID=i,o.setValue(s)},getInfoByIdFormServer:function(e,t){var n=this,r=n.getAppInfoServerUrl+'?isPlanish=true&id='+e;Ext.Ajax.defaultPostHeader='application/json',Ext.Ajax.request({async:!1,url:r,method:'GET',timeout:2e3,success:function(e,n){var r=Ext.JSON.decode(e.responseText);if(r.success){var i='';r.ResultDataValue&&r.ResultDataValue!=''&&(r.ResultDataValue=r.ResultDataValue.replace(/\\n/g,'\\\\u000a'),i=Ext.JSON.decode(r.ResultDataValue)),Ext.typeOf(t)=='function'&&(i==''?alertError('没有获取到应用组件信息！'):t(i))}else alertError('获取应用信息失败！')},failure:function(e,t){alertError('获取应用信息请求失败！')}})},functionBtnClick:function(e,t,n){var r=this,i=e.boundField,s=r.getComponent(i),o=s.appComID;if(o!=''&&o!=null&&o!=undefined){var u=function(t){var n=s.getValue(),i='';t&&t!=''&&(i=t[r.classCode]),i&&i!=''?r.openAppShowWin(n,i,e):alertError('没有类代码！')};r.getInfoByIdFormServer(o,u)}else alertError('功能按钮没有绑定应用！')},openAppShowWin:function(title,classCode,com){var me=this,panel=eval(classCode),maxHeight=document.body.clientHeight*.98,maxWidth=document.body.clientWidth*.98,appList=Ext.create(panel,{maxWidth:maxWidth,maxHeight:maxHeight,autoScroll:!0,model:!0,floating:!0,closable:!0,draggable:!0}).show();appList.on({okClick:function(){var e=appList.getValue();e.length==0?alertError('请选择一个应用！'):e.length==1&&me.setWinformInfo(e[0],com)},itemdblclick:function(e,t,n,r,i,s){me.setWinformInfo(t,com)}})},GetGroupItems:function(e,t,n,r,i){var s=e;if(s==''||s==null)return alertError(s),null;s=getRootPath()+'/'+s;var o=[];return Ext.Ajax.request({async:!1,timeout:6e3,url:s,method:'GET',success:function(e,s){var u=Ext.JSON.decode(e.responseText);if(u.success){var a={count:0,list:[]};u.ResultDataValue&&u['ResultDataValue']!=''&&(a=Ext.JSON.decode(u.ResultDataValue));var f=a.count,l=!1,c=[];i!=''&&(c=i.split(','));for(var h=0;h<f;h++){var p=a.list[h][t],d=a.list[h][n];c.length>0&&(l=Ext.Array.contains(c,p));var v={checked:l,name:r,boxLabel:d,inputValue:p};o.push(v)}}else alertError('获取信息失败！')}}),o},beforeRender:function(){var e=this;e.callParent(arguments),e.header!==!1&&e.updateHeader()},initComponent:function(){var me=this;me.VTypes(),me.LenTypes(),me.OverrideField(),me.addEvents('beforeSave'),me.addEvents('saveClick'),me.addEvents('functionBtnClick'),me.load=function(e){Ext.Ajax.request({async:!1,url:getRootPath()+'/RBACService.svc/RBAC_UDTO_SearchRBACUserById?isPlanish=true&fields=RBACUser_Id,RBACUser_DataTimeStamp,RBACUser_LabID,RBACUser_Account,RBACUser_PWD,RBACUser_EnMPwd,RBACUser_PwdExprd,RBACUser_AccLock,RBACUser_HREmployee_Id,RBACUser_HREmployee_DataTimeStamp,RBACUser_AccBeginTime,RBACUser_AccEndTime&id='+(e?e:-1),method:'GET',timeout:5e3,success:function(e,t){var n=Ext.JSON.decode(e.responseText);if(n.success){if(n.ResultDataValue&&n.ResultDataValue!=''){me.type=='add'&&me.type=='edit';var r=Ext.JSON.decode(n.ResultDataValue);me.getForm().setValues(r)}}else alertError('获取表单数据失败！')},failure:function(e,t){alertError('获取表单数据请求失败！')}})},me.submit=function(objdata){var me=this,url='';me.type=='add'&&(url=me.addDataServerUrl);if(url=='')return;var values=objdata,maxLength=0;for(var i in values){var arr=i.split('_');arr.length>maxLength&&(maxLength=arr.length)}var obj={},addObj=function(key,num,value){var keyArr=key.split('_'),ob='obj';for(var i=1;i<keyArr.length;i++)ob=ob+'["'+keyArr[i]+'"]',Ext.typeOf(eval(ob))==='undefined'&&eval(ob+'={};');keyArr.length==num+1&&(ob=='DataTimeStamp'&&(value=value.split(',')),eval(ob+'=value;'))},objnull={};for(var i=1;i<maxLength;i++)for(var j in values){var value=values[j],tempArr=j.split('_'),tempStr=tempArr[tempArr.length-1];addObj(j,i,value)}if(obj.Id==''||obj.Id==null)obj.Id=-1;var bbobj={AccBeginTime:{},AccEndTime:{}},isEmptyObject=function(e){for(var t in e)return!1;return!0},deleteNodeArr=[];for(var i in bbobj)isEmptyObject(obj[i])&&deleteNodeArr.push(i);for(var i in deleteNodeArr)delete obj[deleteNodeArr[i]];var changeDataTimeStamp=function(e){for(var t in e)Ext.typeOf(e[t])=='object'?changeDataTimeStamp(e[t]):(t=='DataTimeStamp'&&e[t]&&e[t]!=''&&(e[t]=e[t].split(',')),t=='DataTimeStamp'&&me.type=='edit'&&delete e[t])};changeDataTimeStamp(obj);var params={entity:obj};if(me.type=='edit'){var field='';for(var i in values){var keyArr=i.split('_');keyArr.slice(-1)!='DataTimeStamp'&&(field=field+keyArr.slice(1).join('_')+',')}field!=''&&(field=field.slice(0,-1)),params.fields=field}Ext.Ajax.defaultPostHeader='application/json',Ext.Ajax.request({async:!1,url:getRootPath()+'/'+url,params:obj,params:Ext.JSON.encode(params),method:'POST',timeout:5e3,success:function(e,t){var n=Ext.JSON.decode(e.responseText);if(n.success){if(n.ResultDataValue&&n.ResultDataValue!=''){var r=me.objectName+'_Id';me.getForm().setValues([{id:r,value:n.ResultDataValue}])}me.fireEvent('saveClick'),me.isSuccessMsg==1&&alertInfo('保存成功！')}else alertError('处理错误！原因如下:'+action.result.ErrorInfo)},failure:function(e,t){alertError('保存请求失败！')}})},me.isAdd=function(){me.getForm().reset();var e=me.getComponent('dockedItems-buttons');e&&(me.type=='show'&&me.setHeight(me.getHeight()+25),e.show()),me.type='add',me.setReadOnly(!1),me.getForm().reset()},me.isEdit=function(e){var t=me.getComponent('dockedItems-buttons');t&&(me.type=='show'&&me.setHeight(me.getHeight()+25),t.show()),me.type='edit',me.setReadOnly(!1),me.load(e)},me.isShow=function(e){var t=me.getComponent('dockedItems-buttons');t&&(me.type!='show'&&me.setHeight(me.getHeight()-25),t.hide()),me.type='show',me.setReadOnly(!0),me.load(e)},me.setValueByItemId=function(e,t){me.getForm().setValues([{id:e,value:t}])},me.changeStoreData=function(e){var t=Ext.JSON.decode(e.responseText);if(t.ResultDataValue&&t.ResultDataValue!=''){var n=Ext.JSON.decode(t.ResultDataValue);t.ResultDataValue=n,t.list=n.list}else t.list=[];return e.responseText=Ext.JSON.encode(t),e},me.setReadOnly=function(e){var t=me.items.items;for(var n in t)if(!t[n].hasReadOnly){var r=t[n].xtype;r!='button'&&r!='label'&&r!='box'&&t[n].setReadOnly(e)}},me.items=[{xtype:'textfield',name:'RBACUser_Account',fieldLabel:'员工账号',labelWidth:80,labelStyle:'font-style:normal;',width:211,height:22,itemId:'RBACUser_Account',id:'RBACUser_Account',x:10,y:15,readOnly:!1,appComID:'',treeNodeID:'',value:'',isFunctionBtn:!1,emptyText:'3-12位不能重复的账号',blankText:'请输入员工账号',maxLengthText:'长度不能超过12个字符',minLengthText:'长度不能超过3个字符',hidden:!1,sortNum:1,showValidIcon:!1,msgTarget:'side',allowBlank:!1,validateOnBlur:!0,validateOnChange:!0,vtype:'isLen',listeners:{scope:this,specialkey:function(e,t){var n=1,r='sortNum',i=e.ownerCt,s=e[r],o=i.items.items,u=5;(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)&&t.preventDefault();if(s>0&&(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)){t.shiftKey?s=s-n<1?s-n+u:s-n:s=s+n>u?s+n-u:s+n;for(var a in o)if(o[a].sortNum==s){o[a].focus(!1,100);break}}},blur:function(e,t){var n=me.getComponent('RBACUser_Account'),r=n.getValue();me.validator(r)}},hasReadOnly:!1,labelAlign:'left'},{xtype:'label',cls:'textfield-red',style:'color:red;background:white;',labelStyle:'font-style:normal;',width:82,height:22,itemId:'txtBJ',hidden:!0,x:218,y:16,text:'账号已存在'},{xtype:'label',cls:'textfield-red',style:'color:red;background:white;',labelStyle:'font-style:normal;',width:82,height:22,itemId:'txtBJCD',hidden:!0,x:218,y:16,text:'账号长度不符'},{xtype:'box',width:26,id:'yzimage',itemId:'yzimage',x:220,y:10,height:26,hidden:!0,autoEl:{tag:'img',src:''}},{xtype:'datefield',name:'RBACUser_AccBeginTime',fieldLabel:'账号开始日期',labelWidth:80,labelStyle:'font-style:normal;',width:215,height:22,format:'Y-m-d',itemId:'RBACUser_AccBeginTime',msgTarget:'side',x:9,y:70,readOnly:!1,appComID:'',value:me.dateNew,isFunctionBtn:!1,hidden:!1,sortNum:2,listeners:{scope:this,specialkey:function(e,t){var n=1,r='sortNum',i=e.ownerCt,s=e[r],o=i.items.items,u=9;(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)&&t.preventDefault();if(s>0&&(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)){t.shiftKey?s=s-n<1?s-n+u:s-n:s=s+n>u?s+n-u:s+n;for(var a in o)if(o[a].sortNum==s){o[a].focus(!1,100);break}}}},hasReadOnly:!1,labelAlign:'left'},{xtype:'datefield',name:'RBACUser_AccEndTime',fieldLabel:'账号截止日期',labelWidth:80,format:'Y-m-d',labelStyle:'font-style:normal;',width:215,height:22,msgTarget:'side',itemId:'RBACUser_AccEndTime',x:10,y:98,readOnly:!1,appComID:'',treeNodeID:'',value:'',isFunctionBtn:!1,hidden:!1,sortNum:3,listeners:{scope:this,specialkey:function(e,t){var n=1,r='sortNum',i=e.ownerCt,s=e[r],o=i.items.items,u=9;(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)&&t.preventDefault();if(s>0&&(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)){t.shiftKey?s=s-n<1?s-n+u:s-n:s=s+n>u?s+n-u:s+n;for(var a in o)if(o[a].sortNum==s){o[a].focus(!1,100);break}}}},hasReadOnly:!1,labelAlign:'left'},{xtype:'radiogroup',itemId:'pwd',fieldLabel:'',columns:2,labelWidth:150,width:340,x:10,y:125,vertical:!0,listeners:{change:function(e,t,n){var r=e.getValue().pwd,i=me.getComponent('RBACUserNew'),s=me.getComponent('RBACUser_PWD');r=='true'?(s.setValue(''),i.setValue(''),s.show(),i.show()):(s.hide(),i.hide(),s.setValue('123456'),i.setValue('123456'))}},items:[{boxLabel:'设置密码',name:'pwd',inputValue:'true',checked:!0},{boxLabel:'默认密码(123456)',name:'pwd',inputValue:'false'}]},{xtype:'textfield',name:'RBACUserNew',fieldLabel:'密码设置',labelWidth:80,msgTarget:'side',labelStyle:'font-style:normal;',width:215,emptyText:'请输入密码',height:22,itemId:'RBACUserNew',inputType:'password',x:10,y:150,readOnly:!1,appComID:'',treeNodeID:'',value:'',isFunctionBtn:!1,sortNum:4,allowBlank:!1,id:'password',listeners:{scope:this,specialkey:function(e,t){var n=1,r='sortNum',i=e.ownerCt,s=e[r],o=i.items.items,u=9;(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)&&t.preventDefault();if(s>0&&(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)){t.shiftKey?s=s-n<1?s-n+u:s-n:s=s+n>u?s+n-u:s+n;for(var a in o)if(o[a].sortNum==s){o[a].focus(!1,100);break}}}},hasReadOnly:!1,labelAlign:'left'},{xtype:'textfield',name:'RBACUser_PWD',fieldLabel:'密码验证',emptyText:'请再一次输入密码',labelWidth:80,showValidIcon:!0,msgTarget:'side',labelStyle:'font-style:normal;',width:220,height:22,itemId:'RBACUser_PWD',x:10,y:180,inputType:'password',readOnly:!1,appComID:'',treeNodeID:'',value:'',isFunctionBtn:!1,sortNum:4,allowBlank:!1,blankText:'不允许为空',vtype:'password',initialPassField:'password',listeners:{scope:this,specialkey:function(e,t){var n=1,r='sortNum',i=e.ownerCt,s=e[r],o=i.items.items,u=9;(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)&&t.preventDefault();if(s>0&&(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)){t.shiftKey?s=s-n<1?s-n+u:s-n:s=s+n>u?s+n-u:s+n;for(var a in o)if(o[a].sortNum==s){o[a].focus(!1,100);break}}}},hasReadOnly:!1,labelAlign:'left'},{xtype:'checkboxfield',name:'RBACUser_EnMPwd',boxLabel:'允许修改密码',labelWidth:80,fieldLabel:' ',labelSeparator:'',labelStyle:'font-style:normal;',width:220,height:22,itemId:'RBACUser_EnMPwd',x:3,y:205,readOnly:!1,appComID:'',treeNodeID:'',value:'',checked:!0,isFunctionBtn:!1,hidden:!1,sortNum:5,listeners:{scope:this,specialkey:function(e,t){var n=1,r='sortNum',i=e.ownerCt,s=e[r],o=i.items.items,u=9;(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)&&t.preventDefault();if(s>0&&(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)){t.shiftKey?s=s-n<1?s-n+u:s-n:s=s+n>u?s+n-u:s+n;for(var a in o)if(o[a].sortNum==s){o[a].focus(!1,100);break}}}},hasReadOnly:!1,labelAlign:'left'},{xtype:'combobox',name:'RBACUser_HREmployee_Id',fieldLabel:'主键ID',labelWidth:60,labelStyle:'font-style:normal;',width:160,itemId:'RBACUser_HREmployee_Id',x:348,y:80,readOnly:!1,hidden:!0,height:22,value:'',mode:'local',editable:!1,displayField:'HREmployee_CName',valueField:'HREmployee_Id',store:new Ext.data.Store({fields:['HREmployee_CName','HREmployee_Id','HREmployee_DataTimeStamp'],proxy:{type:'ajax',async:!1,url:getRootPath()+'/'+'RBACService.svc/RBAC_UDTO_SearchHREmployeeByHQL?isPlanish=true&where=&',reader:{type:'json',root:'list'},extractResponseData:me.changeStoreData},autoLoad:!0,listeners:{load:function(e,t,n){var r=me.getComponent('RBACUser_HREmployee_Id'),i=me.getComponent('RBACUser_HREmployee_DataTimeStamp');if(i){var s=e.findRecord('HREmployee_Id',r.getValue());if(s!=null&&s!=''){var o=s.get('HREmployee_DataTimeStamp');i.setValue(o)}}}}}),sortNum:11,listeners:{select:function(e,t){var n=e.ownerCt.getComponent('RBACUser_HREmployee_DataTimeStamp');if(n){var r=t[0].get('HREmployee_DataTimeStamp');n.setValue(r)}},scope:this,specialkey:function(e,t){var n=1,r='sortNum',i=e.ownerCt,s=e[r],o=i.items.items,u=12;(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)&&t.preventDefault();if(s>0&&(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)){t.shiftKey?s=s-n<1?s-n+u:s-n:s=s+n>u?s+n-u:s+n;for(var a in o)if(o[a].sortNum==s){o[a].focus(!1,100);break}}}},hasReadOnly:!1,labelAlign:'left'},{xtype:'textfield',name:'RBACUser_HREmployee_DataTimeStamp',fieldLabel:'时间戳',labelWidth:60,labelStyle:'font-style:normal;',width:160,height:22,itemId:'RBACUser_HREmployee_DataTimeStamp',x:5,y:161,readOnly:!1,appComID:'',treeNodeID:'',value:'',isFunctionBtn:!1,hidden:!0,sortNum:7,listeners:{scope:this,specialkey:function(e,t){var n=1,r='sortNum',i=e.ownerCt,s=e[r],o=i.items.items,u=9;(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)&&t.preventDefault();if(s>0&&(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)){t.shiftKey?s=s-n<1?s-n+u:s-n:s=s+n>u?s+n-u:s+n;for(var a in o)if(o[a].sortNum==s){o[a].focus(!1,100);break}}}},hasReadOnly:!1,labelAlign:'left'},{xtype:'textfield',name:'RBACUser_Id',fieldLabel:'主键ID',labelWidth:60,labelStyle:'font-style:normal;',width:160,height:22,itemId:'RBACUser_Id',x:5,y:5,readOnly:!1,appComID:'',treeNodeID:'',value:'',isFunctionBtn:!1,hidden:!0,sortNum:1,listeners:{scope:this,specialkey:function(e,t){var n=1,r='sortNum',i=e.ownerCt,s=e[r],o=i.items.items,u=12;(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)&&t.preventDefault();if(s>0&&(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)){t.shiftKey?s=s-n<1?s-n+u:s-n:s=s+n>u?s+n-u:s+n;for(var a in o)if(o[a].sortNum==s){o[a].focus(!1,100);break}}}},hasReadOnly:!1,labelAlign:'left'},{xtype:'textfield',name:'RBACUser_DataTimeStamp',fieldLabel:'时间戳',labelWidth:60,labelStyle:'font-style:normal;',width:160,height:22,itemId:'RBACUser_DataTimeStamp',x:5,y:213,readOnly:!1,appComID:'',treeNodeID:'',value:'',isFunctionBtn:!1,hidden:!0,sortNum:9,listeners:{scope:this,specialkey:function(e,t){var n=1,r='sortNum',i=e.ownerCt,s=e[r],o=i.items.items,u=9;(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)&&t.preventDefault();if(s>0&&(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)){t.shiftKey?s=s-n<1?s-n+u:s-n:s=s+n>u?s+n-u:s+n;for(var a in o)if(o[a].sortNum==s){o[a].focus(!1,100);break}}}},hasReadOnly:!1,labelAlign:'left'},{xtype:'button',text:'自动生成账号',itemId:'btn',x:93,y:43,width:120,height:22,sortNum:10,handler:function(e,t,n){var r=me.getComponent('txtBJ'),i=me.getComponent('txtBJCD'),s=me.getComponent('yzimage');r.setVisible(!1),i.setVisible(!1),s.setVisible(!1),s.getEl().dom.src='';var o=me.getComponent('RBACUser_Account'),u=me.getComponent('RBACUser_HREmployee_Id'),a=o.getValue(),f=u.getValue();me.CreateUserAccount(f,a),o.setValue(me.AccountValue)}},{xtype:'combobox',name:'RBACUser_LabID',fieldLabel:'实验室ID',labelWidth:60,labelStyle:'font-style:normal;',width:160,height:22,itemId:'RBACUser_LabID',isFunctionBtn:!1,appComID:'',x:513,y:54,readOnly:!1,hidden:!0,value:'',readOnly:!1,mode:'local',editable:!1,displayField:'text',valueField:'value',store:new Ext.data.SimpleStore({fields:['value','text'],autoLoad:!0,data:[['0','0'],['1','1']]}),sortNum:5,listeners:{scope:this,specialkey:function(e,t){var n=1,r='sortNum',i=e.ownerCt,s=e[r],o=i.items.items,u=12;(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)&&t.preventDefault();if(s>0&&(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)){t.shiftKey?s=s-n<1?s-n+u:s-n:s=s+n>u?s+n-u:s+n;for(var a in o)if(o[a].sortNum==s){o[a].focus(!1,100);break}}}},hasReadOnly:!1,labelAlign:'left'},{xtype:'textfield',name:'RBACUser_PwdExprd',fieldLabel:'密码永不过期',labelWidth:60,labelStyle:'font-style:normal;',width:160,height:22,hidden:!0,itemId:'RBACUser_PwdExprd',x:0,y:0,readOnly:!1,appComID:'',treeNodeID:'',value:'',isFunctionBtn:!1,sortNum:5,listeners:{scope:this,specialkey:function(e,t){var n=1,r='sortNum',i=e.ownerCt,s=e[r],o=i.items.items,u=26;(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)&&t.preventDefault();if(s>0&&(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)){t.shiftKey?s=s-n<1?s-n+u:s-n:s=s+n>u?s+n-u:s+n;for(var a in o)if(o[a].sortNum==s){o[a].focus(!1,100);break}}}},hasReadOnly:!1,labelAlign:'left'},{xtype:'radiogroup',name:'RBACUser_AccLock',fieldLabel:'账号被锁定',labelWidth:60,labelStyle:'font-style:normal;',width:160,height:22,columnWidth:100,columns:2,itemId:'RBACUser_AccLock',x:175,y:57,readOnly:!1,vertical:!0,padding:2,autoScroll:!0,hidden:!0,isdataValue:!0,items:[{checked:!1,name:'RBACUser_AccLock',inputValue:'true',boxLabel:'true'},{checked:!1,name:'RBACUser_AccLock',inputValue:'false',boxLabel:'false'}],tempGroupName:'RBACUser_AccLock',sortNum:10,listeners:{scope:this,specialkey:function(e,t){var n=1,r='sortNum',i=e.ownerCt,s=e[r],o=i.items.items,u=12;(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)&&t.preventDefault();if(s>0&&(t.getKey()==Ext.EventObject.ENTER||t.getKey()==Ext.EventObject.TAB)){t.shiftKey?s=s-n<1?s-n+u:s-n:s=s+n>u?s+n-u:s+n;for(var a in o)if(o[a].sortNum==s){o[a].focus(!1,100);break}}}},hasReadOnly:!1,labelAlign:'left'}],me.type=='show'?me.height-=25:me.dockedItems=[{xtype:'toolbar',dock:'bottom',itemId:'dockedItems-buttons',items:['->',{xtype:'button',text:'保存',iconCls:'build-button-save',handler:function(){var e=me.getComponent('RBACUser_Account').getValue(),t=me.getComponent('RBACUser_AccBeginTime').getValue(),n=''+Ext.util.Format.date(t,'Y-m-d'),r=convertJSONDateToJSDateObject(n),i=me.getComponent('RBACUser_AccEndTime').getValue(),s=''+Ext.util.Format.date(i,'Y-m-d'),o=convertJSONDateToJSDateObject(s),u=me.getComponent('RBACUser_PWD').getValue(),a=me.getComponent('RBACUserNew').getValue();if(u==a)var f=u;var l=me.getComponent('RBACUser_EnMPwd').getValue(),c=me.getComponent('RBACUser_HREmployee_Id').getValue(),h=me.getComponent('RBACUser_HREmployee_DataTimeStamp').getValue(),p=1,d=-1,v=!0,m=!1,g={RBACUser_Id:d,RBACUser_Account:e,RBACUser_EnMPwd:l,RBACUser_PWD:f,RBACUser_HREmployee_Id:c,RBACUser_LabID:p,RBACUser_PwdExprd:v,RBACUser_AccLock:m,RBACUser_AccBeginTime:r,RBACUser_AccEndTime:o,RBACUser_HREmployee_DataTimeStamp:h};u.length>2&&u.length<13?me.submit(g):alertInfo('请设置密码长度为3-12个字符')}},{xtype:'button',text:'重置',iconCls:'build-button-refresh',handler:function(){me.getForm().reset()}}]}],me.callParent(arguments)},afterRender:function(){var e=this;e.callParent(arguments),Ext.typeOf(e.callback)=='function'&&e.callback(e),e.type=='add'?e.isAdd():e.type=='edit'?e.isEdit(e.dataId):e.type=='show'&&e.isShow(e.dataId)},CreateUserAccount:function(e,t){var n=this;Ext.Ajax.defaultPostHeader='application/json',Ext.Ajax.request({async:!1,url:n.CreateUserAccountUrl+'?id='+e+'&'+'?strUserAccount='+t,method:'GET',timeout:2e3,success:function(e){var t=Ext.JSON.decode(e.responseText);if(t.success){var r=Ext.JSON.decode(t.ResultDataValue),i=r.UserAccount;n.AccountValue=i}},failure:function(e,t){alertError('获取信息请求失败！')}})},validator:function(e){var t=this,n=this,r=!0;return Ext.Ajax.request({async:!1,scope:n,url:t.CheckUserNameUrl+'?strUserAccount='+e,method:'GET',success:function(e){var n=Ext.JSON.decode(e.responseText),r=Ext.JSON.decode(n.ResultDataValue),i=t.getComponent('txtBJ'),s=t.getComponent('txtBJCD'),o=t.getComponent('yzimage'),u=t.getComponent('RBACUser_Account'),a=u.getValue();r.result=='true'&&(a.length>=3&&a.length<=12?(i.setVisible(!0),s.setVisible(!1),o.setVisible(!1),o.getEl().dom.src=''):(i.setVisible(!1),s.setVisible(!0),o.setVisible(!1),o.getEl().dom.src='')),r.result=='false'&&(a.length>=3&&a.length<=12?(i.setVisible(!1),s.setVisible(!1),o.setVisible(!0),o.getEl().dom.src=getIconRootPathBySize(64)+'/'+'accept.png'):(i.setVisible(!1),s.setVisible(!0),o.setVisible(!1),o.getEl().dom.src=''))},failure:function(e,t){alertError('获取信息请求失败！')}}),r},OverrideField:function(){var e=Ext.layout.component.field.Field.override({getErrorStrategy:function(){var e=this,t=e.owner,n=e.errorStrategies,r=t.msgTarget,i=!t.preventMark&&Ext.isString(r)?n[r]||n.elementId:n.none;return r=='side'&&t.showValidIcon&&(t.isIconInit&&(t.errorEl.setDisplayed(!1),t.isIconInit=!0),t.on('validitychange',function(e,t){e.errorEl.setDisplayed(!0)}),Ext.apply(i,{adjustHorizInsets:Ext.emptyFn,layoutHoriz:function(e,t,n){e.errorContext.setProp('x',n.width)},layoutVert:function(e,t){e.errorContext.setProp('y',e.insets.top)},prepare:function(e,t){var n=t.errorEl;n.addCls(Ext.baseCSSPrefix+'form-invalid-icon'),n.set({'data-errorqtip':t.getActiveError()||''});var r=t.getActiveError(),i=!!r;n[i?'removeCls':'addCls']('icon-yes'),Ext.layout.component.field.Field.initTip()}})),i}});return e},VTypes:function(){var e=Ext.apply(Ext.form.VTypes,{password:function(e,t){if(t.initialPassField){var n=Ext.getCmp(t.initialPassField);return e==n.getValue()}return!0},passwordText:'两次密码不一致'});return e},LenTypes:function(){var e=Ext.apply(Ext.form.VTypes,{isLen:function(e,t){var n=/^[a-zA-Z0-9_]{3,13}$/,r=e.match(n);return r==null?!1:!0},isLenText:'3-12位不能重复的账号'});return e}})