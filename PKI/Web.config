<?xml version="1.0" encoding="utf-8"?>
<configuration>
	<configSections>
		<sectionGroup name="spring">
			<section name="context" type="Spring.Context.Support.ContextHandler, Spring.Core" />
			<section name="parsers" type="Spring.Context.Support.NamespaceParsersSectionHandler, Spring.Core" />
			<section name="objects" type="Spring.Context.Support.DefaultSectionHandler, Spring.Core" />
		</sectionGroup>
		<section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler, log4net" />
		<section name="databaseSettings" type="System.Configuration.NameValueSectionHandler" />
	</configSections>
	
	<!--spring配置-->
	<spring xmlns="http://www.springframework.net">
		<parsers>
			<parser type="Spring.Data.Config.DatabaseNamespaceParser, Spring.Data" />
			<parser type="Spring.Transaction.Config.TxNamespaceParser, Spring.Data" />
		</parsers>
		<context>
			<resource uri="config://spring/objects" />

			<!--数据库访问层配置-->
			<resource uri="assembly://ZhiFang.Digitlab.BA.ObjectFactory/ZhiFang.Digitlab.BA.ObjectFactory.Config/DaoBase.xml" />
			<resource uri="assembly://ZhiFang.Digitlab.BA.ObjectFactory/ZhiFang.Digitlab.BA.ObjectFactory.Config/Dao.xml" />
			<!--业务处理层配置-->
			<resource uri="assembly://ZhiFang.Digitlab.BA.ObjectFactory/ZhiFang.Digitlab.BA.ObjectFactory.Config/ServiceBase.xml" />
			<resource uri="assembly://ZhiFang.Digitlab.BA.ObjectFactory/ZhiFang.Digitlab.BA.ObjectFactory.Config/Service.xml" />
			<!--契约实现-->
			<resource uri="assembly://ZhiFang.Digitlab.BA.ObjectFactory/ZhiFang.Digitlab.BA.ObjectFactory.Config/Facade.xml" />
		</context>
		<objects xmlns="http://www.springframework.net" xmlns:aop="http://www.springframework.net/aop">
			<!--拦截控制层所有业务操作-->
			<object id="serviceOperation" type="Spring.Aop.Support.SdkRegularExpressionMethodPointcut, Spring.Aop">
				<property name="Patterns">
					<list>
						<value>ZhiFang.Digitlab.BA.Service.*</value>
					</list>
				</property>
			</object>
			<object id="MessagePushServiceOperation" type="Spring.Aop.Support.SdkRegularExpressionMethodPointcut, Spring.Aop">
				<property name="Patterns">
					<list>
						<value>ZhiFang.Digitlab.BA.Service.StatService.*</value>
					</list>
				</property>
			</object>
			<!--切面-->
			<object id="MessagePushAdvice" type="ZhiFang.Digitlab.BA.Service.MessagePush.MessagePushInterceptor, ZhiFang.Digitlab.BA.Service" singleton="false" />
			<!--切面-->
			<object id="LogAdvice" type="ZhiFang.Digitlab.BA.Service.Interceptor.InterceptorLog, ZhiFang.Digitlab.BA.Service.Interceptor" singleton="false" />
			<!--切面-->
			<object id="BeforeAdvice" type="ZhiFang.Digitlab.BA.Service.Interceptor.InterceptorAuthorityFilter, ZhiFang.Digitlab.BA.Service.Interceptor" singleton="false" />
			<!--切面-->
			<object id="AfterAdvice" type="ZhiFang.Digitlab.BA.Service.Interceptor.AfterReturningAdvice, ZhiFang.Digitlab.BA.Service.Interceptor" singleton="false" />
			<!--切面-->
			<object id="ExceptAdvice" type="ZhiFang.Digitlab.BA.Service.Interceptor.ExceptAdvice, ZhiFang.Digitlab.BA.Service.Interceptor" singleton="false" />
		</objects>
	</spring>
	
	<!--NHB数据库连接字符串-->
	<databaseSettings>
		<!--.\SQLEXPRESS-->
		<add key="db.provider" value="SqlServer-2.0" />
		<add key="db.connectionString" value="Server=localhost\MSSQLSERVER2012;database=Lis_Finance_New;uid=sa;pwd=longfuchu;" />
		<add key="db.driver_class" value="NHibernate.Driver.SqlClientDriver" />
		<add key="db.dialect" value="NHibernate.Dialect.MsSql2005Dialect" />
		<add key="hbm2ddl.auto" value="update" />
	</databaseSettings>

	<!--ADO数据库连接字符串-->
	<connectionStrings>
		<!--实验室财务数据库连接字符串-->
		<add name="Finance_ConnectStr" connectionString="user id=sa;password=longfuchu;data source=.\MSSQLSERVER2012;initial catalog=ReaDataCenter;" providerName="SqlServer|MSSql"/>
		<!--实验室检验数据库连接字符串-->
		<add name="Digitlab_ConnectStr" connectionString="user id=sa;password=sa;data source=.\MSSQLSERVER2012;initial catalog=PKITest;" providerName="SqlServer|MSSql"/>
	</connectionStrings>

	<appSettings>
		<add key="Spring.Data.NHibernate.Support.SessionScope.SessionFactoryObjectName" value="NHibernateSessionFactory" />
		<!--服务中心名称-->
		<add key="CenterName" value="XXX独立实验室" />
		<add key="DbProcDriver" value=""/>
		<add key="EntityNamespace" value="ZhiFang.Digitlab.BA.Entity"/>
		<!--<add key="IsUpdateFinanceLockFlag" value="0"/>-->
	</appSettings>

	<system.web>
		<httpRuntime requestValidationMode="2.0" maxQueryStringLength="1024000" />
		<pages validateRequest="false" />
		<compilation debug="true" targetFramework="4.0" />
		<sessionState timeout="720" />
	</system.web>

	<system.serviceModel>
		<services>
			<service name="ZhiFang.Digitlab.BA.Service.BaseService">
				<endpoint address="" behaviorConfiguration="ZhiFang.Digitlab.BA.Service.BaseServiceAspNetAjaxBehavior" 
						  binding="webHttpBinding" contract="ZhiFang.Digitlab.BA.Service.ServerContract.IBaseService" />
			</service>
			<service name="ZhiFang.Digitlab.BA.Service.StatService">
				<endpoint address="" behaviorConfiguration="ZhiFang.Digitlab.BA.Service.StatServiceAspNetAjaxBehavior" 
						  binding="webHttpBinding" contract="ZhiFang.Digitlab.BA.Service.ServerContract.IStatService" />
			</service>
			<service name="ZhiFang.Digitlab.BA.Service.RBACService">
				<endpoint address="" behaviorConfiguration="ZhiFang.Digitlab.BA.Service.RBACServiceAspNetAjaxBehavior"
				  binding="webHttpBinding" contract="ZhiFang.Digitlab.BA.Service.ServerContract.IRBACService" />
			</service>
			<service name="ZhiFang.Digitlab.BA.Service.ConstructionService">
				<endpoint address="" behaviorConfiguration="ZhiFang.Digitlab.BA.Service.ConstructionServiceAspNetAjaxBehavior"
				  binding="webHttpBinding" contract="ZhiFang.Digitlab.BA.Service.ServerContract.IConstructionService" />
			</service>
			<service name="ZhiFang.Digitlab.BA.Service.SingleTableService">
				<endpoint address="" behaviorConfiguration="ZhiFang.Digitlab.BA.Service.SingleTableServiceAspNetAjaxBehavior"
				  binding="webHttpBinding" contract="ZhiFang.Digitlab.BA.Service.ServerContract.ISingleTableService" />
			</service>
		</services>
		
		<behaviors>
			<endpointBehaviors>
				<behavior name="ZhiFang.Digitlab.BA.Service.BaseServiceAspNetAjaxBehavior">
					<webHttp helpEnabled="true" />
				</behavior>
				<behavior name="ZhiFang.Digitlab.BA.Service.StatServiceAspNetAjaxBehavior">
					<webHttp helpEnabled="true" />
				</behavior>
				<behavior name="ZhiFang.Digitlab.BA.Service.RBACServiceAspNetAjaxBehavior">
					<webHttp helpEnabled="true" />
				</behavior>
				<behavior name="ZhiFang.Digitlab.BA.Service.ConstructionServiceAspNetAjaxBehavior">
					<webHttp helpEnabled="true" />
				</behavior>
				<behavior name="ZhiFang.Digitlab.BA.Service.SingleTableServiceAspNetAjaxBehavior">
					<webHttp helpEnabled="true" />
				</behavior>
			</endpointBehaviors>
			<serviceBehaviors>
				<behavior name="DefaultBehavior">
					<serviceMetadata httpGetEnabled="true" />
					<serviceDebug includeExceptionDetailInFaults="true" />
				</behavior>
				<behavior name="">
					<serviceMetadata httpGetEnabled="true" />
					<serviceDebug includeExceptionDetailInFaults="false" />
				</behavior>
			</serviceBehaviors>
		</behaviors>
		<bindings>
			<webHttpBinding>
				<binding allowCookies="true" closeTimeout="00:10:00" openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:01:00" maxBufferPoolSize="9223372036854775807" maxBufferSize="2147483647" maxReceivedMessageSize="2147483647"></binding>
			</webHttpBinding>
			<basicHttpBinding>
				<binding closeTimeout="00:10:00" openTimeout="00:10:00" receiveTimeout="00:10:00" sendTimeout="00:10:00" allowCookies="false" bypassProxyOnLocal="false" hostNameComparisonMode="StrongWildcard" maxBufferSize="2147483647" maxBufferPoolSize="2147483647" maxReceivedMessageSize="2147483647" messageEncoding="Text" textEncoding="utf-8" transferMode="Buffered" useDefaultWebProxy="true">
					<readerQuotas maxDepth="2147483647" maxStringContentLength="2147483647" maxArrayLength="2147483647" maxBytesPerRead="2147483647" maxNameTableCharCount="2147483647" />
				</binding>
			</basicHttpBinding>
		</bindings>
		<serviceHostingEnvironment aspNetCompatibilityEnabled="true" multipleSiteBindingsEnabled="true" />
	</system.serviceModel>

	<system.webServer>
		<modules runAllManagedModulesForAllRequests="true">
			<!--WcfReadEntityBodyModeWorkaroundModule 解决Net4.0以上 表单提交的问题-->
			<add name="WcfReadEntityBodyModeWorkaroundModule" type="ZhiFang.Digitlab.BA.Service.WcfReadEntityBodyModeWorkaroundModule, ZhiFang.Digitlab.BA.Service" />
			<add name="ScriptModule" preCondition="integratedMode" type="System.Web.Handlers.ScriptModule, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
		</modules>
		<staticContent>
			<mimeMap fileExtension=".svc" mimeType="application/json; charset=UTF-8" />
		</staticContent>
		<validation validateIntegratedModeConfiguration="false" />
		<handlers>
			<remove name="WebServiceHandlerFactory-Integrated" />
			<add name="ScriptHandlerFactory" verb="*" path="*.asmx" preCondition="integratedMode" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
			<add name="ScriptHandlerFactoryAppServices" verb="*" path="*_AppService.axd" preCondition="integratedMode" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
			<add name="ScriptResource" preCondition="integratedMode" verb="GET,HEAD" path="ScriptResource.axd" type="System.Web.Handlers.ScriptResourceHandler, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
		</handlers>
		<security>
			<requestFiltering>
				<requestLimits maxQueryString="1024000" />
			</requestFiltering>
		</security>
		<directoryBrowse enabled="true" />
		<defaultDocument>
      		<files>
        		<clear />
        		<add value="index.html" />
      		</files>
    	</defaultDocument>
	</system.webServer>

</configuration>
